/*! \file AP_WEB.cpp */

#include "AP.h"     // Definitions
#include "AP_Web.h" // WebPage HTML content

AsyncWebServer server(80); // Create a webserver object that listens for HTTP request on port 80

void handleTimer() {  
  String timer = String(getTimerHour()) + "h :" + String(getTimerMinute()) + "m :" + String(getTimerSecound())+ "s";  // Read timer
  server.send(200, "text/plain", timer);        // Send response to client
}

void setupCalls()
{
  server.on("/", HTTP_GET, [](AsyncWebServerRequest *request)
            { request->send_P(200, "text/html", MAIN_page); });

  server.on("/sun", HTTP_GET, [](AsyncWebServerRequest *request)
            { request->send(LittleFS, "/sun.png", "image/png"); });

  server.on("/readTimer", HTTP_GET, [](AsyncWebServerRequest *request)
            {
    String timer = String(getTimerHour()) + "h :" + String(getTimerMinute()) + "m :" + String(getTimerSecound())+ "s";  // Read timer
    request->send(200, "/readTimer", timer); });

  server.begin();
}

void ProcessWebPage() { 
  server.handleClient();                                  //Handle client requests
  delay(1);                                               // Allow the web server to process the request
}
